<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>YT 多格播放器</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;background:#0f0f0f;color:#ddd;height:100vh;overflow:hidden}#main{height:100vh;background:#000;position:relative;display:flex;flex-direction:column}#controls{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.65);padding:10px 20px;border-radius:30px;z-index:100;display:flex;gap:12px;flex-wrap:wrap;justify-content:center;max-width:92%;transition:opacity .5s}#controls.hidden{opacity:0;pointer-events:none}button{padding:8px 14px;background:#a81c1c;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:.9rem;transition:all .25s}#controls button:hover{background:#c41e1e;transform:translateY(-1px);box-shadow:0 4px 12px rgba(168,28,28,.5)}#add-btn{position:fixed;bottom:30px;right:30px;width:64px;height:64px;border-radius:50%;background:#a81c1c;color:#fff;font-size:2.4rem;border:none;cursor:pointer;box-shadow:0 4px 12px rgba(168,28,28,.6);z-index:200;display:flex;align-items:center;justify-content:center;transition:all .25s}#add-btn:hover{background:#c41e1e;transform:scale(1.1);box-shadow:0 8px 20px rgba(168,28,28,.6)}#grid{flex:1;display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:12px;padding:16px;overflow-y:auto}.video-wrapper{position:relative;background:#111;border-radius:8px;overflow:hidden;aspect-ratio:16/9}.video-wrapper iframe{width:100%;height:100%;border:none}.close-btn,.tab-remove,.remove-item,.close-overlay{background:rgba(30,30,30,.65);color:#aaa;border:none;border-radius:50%;font-size:16px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;opacity:.7}.close-btn:hover,.tab-remove:hover,.remove-item:hover,.close-overlay:hover{background:#a81c1c;color:#fff;opacity:1;transform:scale(1.1)}.close-btn{width:24px;height:24px;position:absolute;top:8px;right:8px;z-index:10}.tab-remove{width:22px;height:22px;margin-left:4px;margin-right:6px}.remove-item{width:20px;height:20px}#no-video-msg{color:#777;font-size:1.6rem;text-align:center;margin:auto;display:flex;align-items:center;justify-content:center;height:100%}.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:300;display:none;align-items:center;justify-content:center}.overlay-content{width:90%;max-width:900px;background:#181818;border-radius:12px;padding:24px;max-height:90vh;overflow-y:auto;box-shadow:0 10px 30px rgba(0,0,0,.7)}.overlay-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.close-overlay{width:26px;height:26px;font-size:18px}#search-input,#online-search{width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #444;background:#222;color:#fff;margin-bottom:16px}#search-results,#online-files-list{margin:16px 0;max-height:50vh;overflow-y:auto}.search-item,.playlist-item,.online-file-item{padding:10px 12px;background:#282828;margin:4px 0;border-radius:6px;cursor:pointer;transition:.15s}.search-item:hover,.playlist-item:hover,.online-file-item:hover{background:#383838}.playlist-item{display:flex;justify-content:space-between;align-items:center;min-width:0}.playlist-item span{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-right:12px;cursor:pointer}.tab-container{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;border-bottom:1px solid #444}.tab-wrapper{display:flex;align-items:center;background:#282828;border-radius:6px 6px 0 0;overflow:hidden}.tab{padding:10px 16px;cursor:pointer;transition:all .25s;background:#1a0f0f;color:#999}.tab:hover{background:#3a1a1a;color:#fff;transform:translateY(-1px)}.tab.active{background:#5c1a1a;color:#fff;box-shadow:inset 0 -3px 0 #8a1a1a}.tab-content{display:none;max-height:45vh;overflow-y:auto;padding-right:8px;scrollbar-width:thin;scrollbar-color:#444 #181818}.tab-content.active{display:block}.tab-content::-webkit-scrollbar{width:6px}.tab-content::-webkit-scrollbar-track{background:#181818;border-radius:10px;margin:2px}.tab-content::-webkit-scrollbar-thumb{background:#444;border-radius:10px;border:2px solid #181818}.tab-content::-webkit-scrollbar-thumb:hover{background:#a81c1c}.load-buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:24px;padding-top:16px;border-top:1px solid #444}.small-btn{padding:6px 10px;font-size:.85rem}#message-bar{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:rgba(20,20,20,.9);color:#ccc;padding:10px 20px;border-radius:30px;z-index:500;display:none;opacity:0;transition:opacity .4s;font-size:.85rem;max-width:80%;text-align:center;border:1px solid rgba(80,80,80,.5)}#message-bar.show{display:block;opacity:1}
  </style>
</head>
<body>
<div id="main">
  <div id="controls">
    <button onclick="playAll()">全部播放</button>
    <button onclick="pauseAll()">全部暫停</button>
    <button onclick="toggleMuteAll()">靜音/取消靜音</button>
    <button onclick="clearAllVideos()">清除所有影片</button>
    <button onclick="copyCurrentVideosUrl()">複製目前影片設定</button>
  </div>
  <div id="grid"></div>
  <div id="no-video-msg">點擊右下角 + 按鈕開啟播放清單</div>
  <button id="add-btn">+</button>
</div>

<div id="playlist-overlay" class="overlay">
  <div class="overlay-content">
    <div class="overlay-header">
      <h2>播放清單管理</h2>
      <button class="close-overlay" onclick="closeOverlay()">×</button>
    </div>
    <input type="text" id="search-input" placeholder="搜尋所有播放清單的影片標題...">
    <div id="search-results"></div>
    <div class="tab-container" id="tab-buttons"></div>
    <div id="tab-contents"></div>
    <div class="load-buttons">
      <button onclick="loadLocalJson()">從本地加入</button>
      <button onclick="showOnlinePlaylistOverlay()">從線上加入</button>
      <button onclick="saveCurrentTab()">儲存此分頁</button>
      <button onclick="saveAllTabs()">儲存所有分頁</button>
      <button onclick="showNewTabOverlay()">新增分頁</button>
      <button onclick="showAddVideoOverlay()">加入影片到此分頁</button>
    </div>
  </div>
</div>

<div id="online-playlist-overlay" class="overlay" style="z-index:350">
  <div class="overlay-content">
    <div class="overlay-header">
      <h2>線上播放清單</h2>
      <button class="close-overlay" onclick="document.getElementById('online-playlist-overlay').style.display='none'">×</button>
    </div>
    <div id="online-repo-info" style="margin-bottom:12px;color:#aaa;font-size:.9rem"></div>
    <div style="margin-bottom:16px;display:flex;gap:10px;flex-wrap:wrap">
      <input type="text" id="online-search" placeholder="搜尋線上清單名稱..." style="flex:1">
      <button onclick="showOnlinePlaylistOverlay()" class="small-btn">重新載入</button>
      <button onclick="useOriginalRepo()" class="small-btn">使用原版</button>
    </div>
    <div id="online-files-list" style="max-height:45vh;overflow-y:auto"></div>
    <div style="margin-top:24px;padding-top:16px;border-top:1px solid #444">
      <h3 style="margin-bottom:12px">加入播放清單 JSON</h3>
      <input type="text" id="json-url" placeholder="輸入 JSON 完整網址 (支援 GitHub raw 等)" style="width:100%;padding:12px;margin-bottom:16px;background:#222;border:1px solid #444;color:#fff;border-radius:6px">
      <button onclick="addJsonFromUrl()" class="small-btn">加入到目前分頁</button>
    </div>
  </div>
</div>

<div id="new-tab-overlay" class="overlay" style="z-index:400">
  <div id="new-tab-box">
    <h3>建立新分頁</h3>
    <input type="text" id="new-tab-name" placeholder="請輸入分頁名稱" style="width:100%;padding:12px;margin:20px 0;background:#222;border:1px solid #444;color:#fff;border-radius:6px">
    <div style="display:flex;gap:12px;justify-content:center;margin-top:20px">
      <button onclick="document.getElementById('new-tab-overlay').style.display='none'" class="small-btn">取消</button>
      <button onclick="createNewTab()" class="small-btn">建立</button>
    </div>
  </div>
</div>

<div id="add-video-overlay" class="overlay" style="z-index:400">
  <div id="add-video-box">
    <h3 style="margin-bottom:20px">加入新影片到目前分頁</h3>
    <input type="text" id="new-title" placeholder="影片標題" style="width:100%;padding:10px;margin-bottom:12px;background:#222;border:1px solid #444;color:#fff;border-radius:6px">
    <input type="text" id="new-id" placeholder="YouTube ID 或完整網址" style="width:100%;padding:10px;margin-bottom:20px;background:#222;border:1px solid #444;color:#fff;border-radius:6px">
    <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:20px">
      <button onclick="document.getElementById('add-video-overlay').style.display='none'" class="small-btn">取消</button>
      <button onclick="addVideoToCurrentTab()" class="small-btn">加入</button>
    </div>
  </div>
</div>

<div id="message-bar"></div>
<input type="file" id="local-json-input" accept=".json" style="display:none">

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let players={},isMuted=true,currentPlaylists=[],currentTabIndex=-1;const GITHUB_TREE_URL=getGitHubRepoApiUrl(),RAW_BASE=getRawBaseUrl(),PAGES_BASE_URL=getPagesBaseUrl();function getGitHubRepoApiUrl(){const e=window.location.href.match(/github\.com\/([^/]+)\/([^/]+)/i);return e&&3===e.length?`https://api.github.com/repos/${e[1]}/${e[2].split("#")[0].split("?")[0].split("/")[0]}/git/trees/main?recursive=1`:"https://api.github.com/repos/alanfox2000software/ytcustomplayer/git/trees/main?recursive=1"}function getRawBaseUrl(){const e=getGitHubRepoApiUrl().match(/repos\/([^/]+)\/([^/]+)\//);return e?`https://raw.githubusercontent.com/${e[1]}/${e[2]}/main/`:"https://raw.githubusercontent.com/alanfox2000software/ytcustomplayer/main/"}function getPagesBaseUrl(){const e=window.location.href.match(/github\.com\/([^/]+)\/([^/]+)/i);return e&&3===e.length?`https://${e[1]}.github.io/${e[2].split("#")[0].split("?")[0].split("/")[0]}/`:"https://alanfox2000software.github.io/ytcustomplayer/"}console.log("API:",GITHUB_TREE_URL),console.log("RAW:",RAW_BASE),console.log("Pages:",PAGES_BASE_URL);const controls=document.getElementById("controls");let hideTimer=null;function showControls(){controls.classList.remove("hidden"),clearTimeout(hideTimer),hideTimer=setTimeout(()=>controls.classList.add("hidden"),4e3)}document.addEventListener("mousemove",showControls),document.addEventListener("click",showControls);const playlistOverlay=document.getElementById("playlist-overlay"),addBtn=document.getElementById("add-btn");addBtn.onclick=()=>{playlistOverlay.style.display="flex",renderTabs()};function closeOverlay(){playlistOverlay.style.display="none",document.getElementById("search-input").value="",document.getElementById("search-results").innerHTML=""}function onYouTubeIframeAPIReady(){console.log("YouTube IFrame API Ready"),loadVideosFromUrl()}function loadVideosFromUrl(){const e=new URLSearchParams(window.location.search).get("videos");if(e){const t=e.split(",").map(e=>e.trim()).filter(e=>11===e.length);t.length>0&&(t.forEach(e=>addVideoToGrid(e,"從網址載入")),showMessage(`已從網址載入 ${t.length} 部影片`,"success"))}}function copyCurrentVideosUrl(){const e=Object.keys(players);0===e.length?showMessage("目前沒有任何影片","error"):navigator.clipboard.writeText(`${PAGES_BASE_URL}?videos=${e.join(",")}`).then(()=>showMessage("已複製目前影片設定連結到剪貼簿","success")).catch(e=>showMessage("複製失敗："+e.message,"error"))}async function showOnlinePlaylistOverlay(){const e=document.getElementById("online-files-list"),t=document.getElementById("online-repo-info");e.innerHTML='<div style="padding:20px;text-align:center;color:#aaa">正在載入線上播放清單...</div>',document.getElementById("online-playlist-overlay").style.display="flex";const o=GITHUB_TREE_URL.includes("alanfox2000software")?"原版儲存庫":"您 Fork 的儲存庫";t.innerHTML=`目前載入自：${o}<br><small style="color:#888">API: ${GITHUB_TREE_URL.split("/repos/")[1]||"..."}</small>`;try{const n=new AbortController,a=setTimeout(()=>n.abort(),12e3),r=await fetch(GITHUB_TREE_URL,{method:"GET",headers:{"Accept":"application/vnd.github.v3+json","User-Agent":"yt-multiviewer-browser"},mode:"cors",cache:"no-cache",signal:n.signal});if(clearTimeout(a),!r.ok){let e=`GitHub API 錯誤: ${r.status}`;throw 403===r.status&&(e+=" (速率限制，請稍後再試或使用 VPN)"),404===r.status&&(e+=" (找不到儲存庫或 main 分支)"),new Error(e)}const i=await r.json(),l=i.tree||[],s=l.filter(e=>"blob"===e.type&&e.path?.startsWith("playlist/")&&e.path.endsWith(".json")).map(e=>e.path.replace(/^playlist\//,""));e.innerHTML="",0===s.length?e.innerHTML='<div style="padding:20px;color:#888;text-align:center">目前 playlist 資料夾沒有 .json 檔案</div>':(s.sort(),s.forEach(t=>{const o=document.createElement("div");o.className="online-file-item",o.textContent=t,o.style.cursor="pointer",o.addEventListener("click",()=>loadOnlinePlaylist(t)),e.appendChild(o)})),document.getElementById("online-search").oninput=function(){const t=this.value.trim().toLowerCase();Array.from(e.children).forEach(e=>{e.style.display=e.textContent.toLowerCase().includes(t)?"":"none"})}}catch(e){let t=e.message||"載入失敗";"AbortError"===e.name&&(t="載入超時（12秒）"),e.innerHTML=`<div style="padding:20px;color:#ff6666;text-align:center">${t}<br><small>可嘗試點擊下方按鈕切換原版儲存庫</small></div>`,console.error("GitHub API 載入失敗:",e)}}async function loadOnlinePlaylist(e){let t=`${RAW_BASE}playlist/${e}`;t=t.replace(/([^:]\/)\/+/g,"$1"),t=t.replace(/^https?:\/+/,"https://"),console.log("嘗試載入 JSON:",t);try{const o=new AbortController,n=setTimeout(()=>o.abort(),1e4),a=await fetch(t,{method:"GET",mode:"cors",cache:"no-cache",redirect:"follow",signal:o.signal});if(clearTimeout(n),!a.ok)throw new Error(`HTTP ${a.status} - ${a.statusText}`);const r=await a.text();let i;try{i=JSON.parse(r)}catch(e){throw new Error("JSON 解析失敗："+e.message)}addNewPlaylistGroup(i),document.getElementById("online-playlist-overlay").style.display="none",showMessage(`成功載入：${e}`,"success")}catch(e){let t="載入失敗";"AbortError"===e.name&&(t="載入超時（10秒）"),e.message.includes("404")&&(t="找不到檔案"),showMessage(`${t}：${e}`,"error"),console.error("載入 JSON 失敗:",e,"\nURL:",t)}}async function addJsonFromUrl(){const e=document.getElementById("json-url"),t=e.value.trim();if(!t)return void showMessage("請輸入 JSON 完整網址","error");if(!t.startsWith("https://"))return void showMessage("網址必須以 https:// 開頭","error");try{const o=new AbortController,n=setTimeout(()=>o.abort(),1e4),a=await fetch(t,{method:"GET",mode:"cors",cache:"no-cache",redirect:"follow",signal:o.signal});if(clearTimeout(n),!a.ok)throw new Error(`HTTP ${a.status} - ${a.statusText}`);const r=await a.text();let i;try{i=JSON.parse(r)}catch(e){throw new Error("JSON 解析失敗："+e.message)}addNewPlaylistGroup(i),document.getElementById("online-playlist-overlay").style.display="none",showMessage("已成功從網址加入播放清單","success"),e.value=""}catch(e){let t="加入失敗";"AbortError"===e.name&&(t="載入超時（10秒）"),e.message.includes("404")&&(t="找不到該 JSON 檔案"),e.message.includes("CORS")&&(t="CORS 錯誤（該網址不支援跨域請求）"),showMessage(t,"error"),console.error("從 URL 加入 JSON 失敗:",e,"\nURL:",t)}}function useOriginalRepo(){confirm("確定要切換回原版 alanfox2000software 儲存庫嗎？")&&(localStorage.setItem("forceOriginalRepo","true"),location.reload())}localStorage.getItem("forceOriginalRepo")==="true"&&(localStorage.removeItem("forceOriginalRepo"),showMessage("已切換回原版儲存庫，請重新點擊「從線上加入」","success"));function addVideoToGrid(e,t=""){if(players[e])return;document.getElementById("no-video-msg").style.display="none";const o=document.createElement("div");o.className="video-wrapper",o.id=`wrapper-${e}`;const n=document.createElement("button");n.className="close-btn",n.textContent="×",n.onclick=()=>removeVideo(e),o.appendChild(n);const a=document.createElement("div");a.id=`player-${e}`,o.appendChild(a),document.getElementById("grid").appendChild(o);const r=new YT.Player(`player-${e}`,{height:"100%",width:"100%",videoId:e,playerVars:{autoplay:1,mute:isMuted?1:0,rel:0,modestbranding:1,controls:1},events:{onReady:e=>e.target.playVideo()}});players[e]=r}function removeVideo(e){const t=document.getElementById(`wrapper-${e}`);t&&(players[e]?.destroy(),delete players[e],t.remove(),0===Object.keys(players).length&&(document.getElementById("no-video-msg").style.display="flex"))}function playAll(){Object.values(players).forEach(e=>e?.playVideo?.()),showControls()}function pauseAll(){Object.values(players).forEach(e=>e?.pauseVideo?.()),showControls()}function toggleMuteAll(){isMuted=!isMuted,Object.values(players).forEach(e=>isMuted?e?.mute?.():e?.unMute?.()),showControls()}function clearAllVideos(){Object.keys(players).forEach(e=>removeVideo(e)),showControls()}function copyCurrentVideosUrl(){const e=Object.keys(players);0===e.length?showMessage("目前沒有任何影片","error"):navigator.clipboard.writeText(`${PAGES_BASE_URL}?videos=${e.join(",")}`).then(()=>showMessage("已複製目前影片設定連結到剪貼簿","success")).catch(e=>showMessage("複製失敗："+e.message,"error"))}document.getElementById("search-input").addEventListener("input",doSearch);function doSearch(){const e=document.getElementById("search-input").value.trim().toLowerCase(),t=document.getElementById("search-results");if(t.innerHTML="",!e)return;const o=[];currentPlaylists.forEach((e,n)=>{e.items.forEach((e,a)=>{e.title.toLowerCase().includes(e)&&o.push({...e,playlistName:e.playlist,plIndex:n,itemIndex:a})})});if(0===o.length)return void(t.innerHTML='<div style="padding:12px;color:#777">無符合結果</div>');o.slice(0,50).forEach(e=>{const o=document.createElement("div");o.className="search-item",o.textContent=`[${e.playlistName}] ${e.title}`,o.title=e.title,o.onclick=()=>addVideoToGrid(e.id,e.title),t.appendChild(o)})}function showNewTabOverlay(){document.getElementById("new-tab-overlay").style.display="flex",document.getElementById("new-tab-name").value="",document.getElementById("new-tab-name").focus()}function createNewTab(){const e=document.getElementById("new-tab-name").value.trim();e?(currentPlaylists.push({playlist:e,items:[]}),document.getElementById("new-tab-overlay").style.display="none",renderTabs(),switchTab(currentPlaylists.length-1),showMessage(`已新增分頁：「${e}」`,"success")):showMessage("請輸入分頁名稱","error")}function showAddVideoOverlay(){currentTabIndex<0?showMessage("請先選擇一個分頁","error"):(document.getElementById("add-video-overlay").style.display="flex",document.getElementById("new-title").value="",document.getElementById("new-id").value="")}function addVideoToCurrentTab(){const e=document.getElementById("new-title").value.trim(),t=document.getElementById("new-id").value.trim();if(!e||!t)return void showMessage("標題與 ID/網址皆為必填","error");let o=t;t.includes("youtube.com")||t.includes("youtu.be")&&(o=t.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/i)?.[1]||"");if(!o||11!==o.length)return void showMessage("無法解析有效的 YouTube 影片 ID","error");if(currentPlaylists[currentTabIndex].items.some(e=>e.id===o))return void showMessage("此影片 ID 已存在於目前分頁","error");currentPlaylists[currentTabIndex].items.push({title:e,id:o}),document.getElementById("add-video-overlay").style.display="none",renderTabs(),showMessage(`已加入：「${e}」`,"success")}document.getElementById("local-json-input").addEventListener("change",e=>{const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=e=>{try{const t=JSON.parse(e.target.result);addNewPlaylistGroup(t),showMessage("本地檔案載入成功","success")}catch(e){showMessage("JSON 格式錯誤："+e.message,"error")}},o.readAsText(t)});function loadLocalJson(){document.getElementById("local-json-input").click()}function addNewPlaylistGroup(e){let t=[];if(Array.isArray(e)){if(e[0]?.playlist&&Array.isArray(e[0].items))t=e;else{t=[{playlist:"新載入清單 "+new Date().toLocaleDateString(),items:e.filter(e=>e.id).map(e=>({title:e.title||"未命名",id:e.id}))}]}}if(0===t.length)return void showMessage("無有效資料","error");const o=new Set(currentPlaylists.map(e=>e.playlist)),n=[];t.forEach(e=>{let t=e.playlist,n=1;for(;o.has(t);)t=`${e.playlist} (${n++})`;n.push({...e,playlist:t}),o.add(t)}),currentPlaylists.push(...n),renderTabs(),showMessage(`已加入 ${n.length} 個分頁（避免重名）`,"success")}function renderTabs(){const e=document.getElementById("tab-buttons"),t=document.getElementById("tab-contents");e.innerHTML="",t.innerHTML="",0===currentPlaylists.length?(e.innerHTML='<div style="padding:12px;color:#777">尚未載入任何播放清單</div>',0):currentPlaylists.forEach((o,n)=>{const a=document.createElement("div");a.className="tab-wrapper";const r=document.createElement("div");r.className="tab",r.textContent=o.playlist||`清單 ${n+1}`,r.dataset.index=n,r.onclick=()=>switchTab(n),a.appendChild(r);const i=document.createElement("button");i.className="tab-remove",i.textContent="×",i.onclick=e=>{e.stopPropagation(),currentPlaylists.splice(n,1),renderTabs(),currentTabIndex>=currentPlaylists.length&&switchTab(currentPlaylists.length-1),showMessage("分頁已移除","success")},a.appendChild(i),e.appendChild(a);const l=document.createElement("div");l.className="tab-content",l.id=`tab-content-${n}`,o.items.forEach((e,t)=>{const o=document.createElement("div");o.className="playlist-item";const n=document.createElement("span");n.textContent=e.title,n.title=e.title,n.onclick=e=>{e.stopPropagation(),addVideoToGrid(e.id,e.title)};const a=document.createElement("button");a.className="remove-item",a.textContent="×",a.onclick=e=>{e.stopPropagation(),o.items.splice(t,1),renderTabs(),showMessage("項目已移除","success")},o.appendChild(n),o.appendChild(a),l.appendChild(o)}),t.appendChild(l)}),currentTabIndex<0&&currentPlaylists.length>0?switchTab(0):currentTabIndex>=currentPlaylists.length?switchTab(currentPlaylists.length-1):currentTabIndex>=0&&switchTab(currentTabIndex)}function switchTab(e){currentTabIndex=parseInt(e),document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`.tab[data-index="${e}"]`);t&&t.classList.add("active"),document.getElementById(`tab-content-${e}`)?.classList.add("active")}function showMessage(e,t="success"){const o=document.getElementById("message-bar");o.textContent=e,o.className=`show ${t}`,setTimeout(()=>o.classList.remove("show"),2e3)}function saveCurrentTab(){if(currentTabIndex<0||currentTabIndex>=currentPlaylists.length)return void showMessage("請先選擇一個分頁","error");const e=[currentPlaylists[currentTabIndex]];downloadJson(e,`playlist_${currentPlaylists[currentTabIndex].playlist||"tab"}_${new Date().toISOString().slice(0,10)}.json`),showMessage("此分頁已儲存為 JSON","success")}function saveAllTabs(){0===currentPlaylists.length?showMessage("沒有可儲存的播放清單","error"):downloadJson(currentPlaylists,`all_playlists_${new Date().toISOString().slice(0,10)}.json`)}function downloadJson(e,t){const o=JSON.stringify(e,null,2),n=new Blob([o],{type:"application/json"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=t,r.click(),URL.revokeObjectURL(a)}
  </script>
</body>
</html>